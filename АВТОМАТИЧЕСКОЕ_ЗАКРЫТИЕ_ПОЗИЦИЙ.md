# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π

## ‚úÖ –î–∞, –±–æ—Ç –ú–û–ñ–ï–¢ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏

–ë–æ—Ç –∏–º–µ–µ—Ç –ø–æ–ª–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π.

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ

### 1. –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç —Å–∏–≥–Ω–∞–ª—ã CLOSE

–¢–æ—Ä–≥–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç —Ä—ã–Ω–æ–∫ –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç —Å–∏–≥–Ω–∞–ª—ã –∑–∞–∫—Ä—ã—Ç–∏—è:

**EnhancedMultiIndicator** (`src/strategies/enhanced_multi_indicator.py`):
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª CLOSE –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∏–≥–Ω–∞–ª –Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏–µ

**SimpleTrend** (`src/strategies/simple_trend.py`):
- –¢–∞–∫–∂–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª—ã CLOSE
- –û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –∞–Ω–∞–ª–∏–∑–µ —Ç—Ä–µ–Ω–¥–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏–∏

### 2. StrategyManager –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–∏–≥–Ω–∞–ª—ã

–í `src/strategies/strategy_manager.py`:

```python
def evaluate_strategies(self):
    """Evaluate all active strategies"""
    for strategy in self.strategies:
        signals = strategy.analyze()
        
        for signal in signals:
            self._execute_signal(signal, strategy)

def _execute_signal(self, signal: Dict, strategy: BaseStrategy):
    """Execute a trading signal"""
    action = signal.get('action')
    
    if action == 'BUY':
        self._execute_buy(signal, strategy)
    elif action == 'SELL':
        self._execute_sell(signal, strategy)
    elif action == 'CLOSE':  # ‚Üê –û–ë–†–ê–ë–û–¢–ö–ê –ó–ê–ö–†–´–¢–ò–Ø
        self._close_position(signal, strategy)
```

### 3. –ú–µ—Ç–æ–¥ _close_position –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é

```python
def _close_position(self, signal: Dict, strategy: BaseStrategy):
    """Close an open position"""
    # 1. –ü–æ–ª—É—á–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ –ø–æ–∑–∏—Ü–∏–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    position = self.db.get_position(position_id)
    
    # 2. –†–∞–∑–º–µ—â–∞–µ—Ç –≤—Å—Ç—Ä–µ—á–Ω—ã–π –æ—Ä–¥–µ—Ä –Ω–∞ –±–∏—Ä–∂–µ
    close_side = 'sell' if side == 'BUY' else 'buy'
    order = self.client.create_order(
        symbol=symbol,
        side=close_side,
        order_type='market',
        quantity=quantity
    )
    
    # 3. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç P&L
    pnl = (exit_price - entry_price) * quantity  # –¥–ª—è BUY
    pnl_percent = (pnl / (entry_price * quantity) * 100)
    
    # 4. –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    self.db.update_position(position_id, status='closed')
    
    # 5. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
    notifier.notify_position_closed(...)
```

## üìã –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏

1. **–°—Ç—Ä–∞—Ç–µ–≥–∏—è –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä—ã–Ω–æ–∫** –∏ —Ä–µ—à–∞–µ—Ç, —á—Ç–æ –ø–æ—Ä–∞ –∑–∞–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é
2. **–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–∏–≥–Ω–∞–ª CLOSE** —Å ID –ø–æ–∑–∏—Ü–∏–∏
3. **StrategyManager –ø–æ–ª—É—á–∞–µ—Ç —Å–∏–≥–Ω–∞–ª** –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `_close_position()`
4. **–†–∞–∑–º–µ—â–∞–µ—Ç—Å—è –æ—Ä–¥–µ—Ä –Ω–∞ –±–∏—Ä–∂–µ** (–ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞)
5. **–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏–±—ã–ª—å/—É–±—ã—Ç–æ–∫**
6. **–ü–æ–∑–∏—Ü–∏—è –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –∑–∞–∫—Ä—ã—Ç–∞—è** –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
7. **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ** —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏

## üéØ Stop Loss –∏ Take Profit

–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏ –±–æ—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç:

```python
stop_loss = self.risk_manager.calculate_stop_loss(price, 'BUY')
take_profit = self.risk_manager.calculate_take_profit(price, 'BUY')
```

–≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π –æ –∑–∞–∫—Ä—ã—Ç–∏–∏.

## üìä –ú–µ—Ç–æ–¥—ã –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ —Å–∏–≥–Ω–∞–ª—É —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
```python
# –°—Ç—Ä–∞—Ç–µ–≥–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª
{
    'action': 'CLOSE',
    'position_id': 123,
    'price': current_price
}
```

### –ó–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π (–∞–≤–∞—Ä–∏–π–Ω–æ–µ)
```python
def close_all_positions(self):
    """Close all open positions"""
    open_positions = self.db.get_open_positions()
    
    for position in open_positions:
        # –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –∫–∞–∂–¥—É—é –ø–æ–∑–∏—Ü–∏—é
        close_side = 'sell' if side == 'BUY' else 'buy'
        order = self.client.create_order(...)
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –õ–æ–≥–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏

–ö–æ–≥–¥–∞ –±–æ—Ç –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é, –≤ –ª–æ–≥–∞—Ö –±—É–¥–µ—Ç:

```
INFO - Position closed: Order ID 12345, Exit price: 100.50
INFO - Position 123 closed with P&L: $10.50 (+2.50%)
```

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è Telegram

–ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:

```
‚úÖ Position Closed

üìä Symbol: BTCUSDT
üìà Side: BUY
üí∞ Quantity: 0.001
üì• Entry: $99,839.34
üì§ Exit: $100,500.00

üí∞ P&L: $10.50 (+2.50%)
üéØ Strategy: EnhancedMultiIndicator

‚è∞ Time: 2026-01-08 13:30:00
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è

–í —Ñ–∞–π–ª–µ `config.yaml`:

```yaml
# –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —Ç–æ—Ä–≥–æ–≤–ª—é
trading_enabled: true  # –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å true –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–∞–º–∏
risk_management:
  stop_loss_percent: 2.0      # 2% —Å—Ç–æ–ø-–ª–æ—Å—Å
  take_profit_percent: 5.0    # 5% —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç
  max_position_size: 0.01     # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏
```

## ‚ùì –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### Q: –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏–∏?
**A**: –î–∞! –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç —Ä—ã–Ω–æ–∫ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç —Å–∏–≥–Ω–∞–ª—ã CLOSE.

### Q: –ö–∞–∫ —á–∞—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –∑–∞–∫—Ä—ã—Ç–∏—è?
**A**: –ù–∞ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –±–æ—Ç–∞. –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ.

### Q: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ stop-loss –Ω–∞ –±–∏—Ä–∂–µ?
**A**: –ù–µ—Ç, stop-loss –∏ take-profit —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±–æ—Ç–µ. –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π –æ –∑–∞–∫—Ä—ã—Ç–∏–∏.

### Q: –ß—Ç–æ –µ—Å–ª–∏ –±–æ—Ç –≤—ã–∫–ª—é—á–µ–Ω - –ø–æ–∑–∏—Ü–∏–∏ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º–∏?
**A**: –î–∞. –ü–æ–∑–∏—Ü–∏–∏ –Ω–∞ –±–∏—Ä–∂–µ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º–∏. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ –±–æ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥.

### Q: –ú–æ–∂–Ω–æ –ª–∏ –∑–∞–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é –≤—Ä—É—á–Ω—É—é?
**A**: –î–∞, –µ—Å—Ç—å –º–µ—Ç–æ–¥ `close_all_positions()` –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é –¥–ª—è —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π.

## üîß –û—Ç–ª–∞–¥–∫–∞

–ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏–∏ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏**:
   ```bash
   sudo journalctl -u trading-bot -f | grep -i "close\|position"
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∞–∫—Ç–∏–≤–Ω–∞**:
   ```bash
   grep "active_strategy" config.yaml
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–æ—Ä–≥–æ–≤–ª—è –≤–∫–ª—é—á–µ–Ω–∞**:
   ```bash
   grep "trading_enabled" config.yaml
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ –ª–æ–≥–∞—Ö**:
   - –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏
   - –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–æ–ª–∂–Ω—ã –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Ö

## ‚úÖ –í—ã–≤–æ–¥

**–ë–æ—Ç –ü–û–õ–ù–û–°–¢–¨–Æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π** –∏ –º–æ–∂–µ—Ç:
- ‚úÖ –û—Ç–∫—Ä—ã–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –ø–æ —Å–∏–≥–Ω–∞–ª–∞–º
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –ø–æ —Å–∏–≥–Ω–∞–ª–∞–º
- ‚úÖ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å P&L
- ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- ‚úÖ –í–µ—Å—Ç–∏ –∏—Å—Ç–æ—Ä–∏—é –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞!
